<div class="container">
    <div class="box">
        <article class="media">
            <figure class="media-left">
                <p class="image is-64x64">
                <img src="https://bulma.io/images/placeholders/128x128.png">
                </p>
            </figure>
            
            <div class="media-content">
                <div class="content">
                    <p>
                        <strong> {{post.title}} </strong>
                        <br>
                        {{post.post_body}}
                        <br>
                        <small>{{post.user.username}} · {{format_date post.created_at}} ·</small>
                    </p>

                    {{!-- <div class="buttons has-addons is-right">
                        <button class="button is-info is-outlined is-small js-modal-toggle"=>
                            <span class="icon is-small">
                                <i class="fas fa-pencil"></i>
                            </span>
                            <span>Edit Post</span>
                        </button>

                        <button class="button is-danger is-small">
                            <span class="icon is-small">
                                <i class="fas fa-trash-can"></i>
                            </span>
                            <span>Delete Post</span>
                        </button>
                    </div> --}}
                </div>

                {{#if post.comments}}
                {{#each post.comments}}
                <article class="media">
                    <figure class="media-left">
                    <p class="image is-48x48">
                        <img src="https://bulma.io/images/placeholders/96x96.png">
                    </p>
                    </figure>
                    <div class="media-content">
                        {{#if isEqual ../user user_id}}
                        <div class="content">
                            <p> <strong>{{user.username}}</strong> </p>
                            <p> {{comment_body}} </p>
                            <p> <small>{{format_date created_at}}</small> </p>

                            <div class="buttons has-addons is-right js-modal-trigger"  id="edit-comment-button" data-target="#editComment{{id}}">
                                <button class="button is-info is-outlined is-small">
                                    <span class="icon is-small">
                                        <i class="fas fa-pencil"></i>
                                    </span>
                                    <span>Edit Comment</span>
                                </button>

                                <button class="button is-danger is-small js-modal-trigger" data-target="#deleteComment{{id}}">
                                    <span class="icon is-small">
                                        <i class="fas fa-trash-can"></i>
                                    </span>
                                    <span>Delete Comment</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </article>

                <div class="buttons has-addons is-right mt-5 js-modal-trigger" data-target="#addComment">
                    <button class="button is-info is-small">
                        <span class="icon is-small">
                            <i class="fas fa-circle-plus"></i>
                        </span>
                        <span>Add New Comment</span>
                    </button>
                </div>   
            </div>
        </article>
    </div>
</div>

{{!-- add comment modal --}}
<div class="modal" id="addComment" aria-hidden="true">
    <div class="modal-background">
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Add A New Comment</p>
                <button class="delete" aria-label="close"></button>
            </header>

            <section class="modal-card-body">
                <textarea class="textarea" id="new-comment-body" placeholder="Write your comment here..."></textarea>
            </section>

            <footer class="modal-card-foot">
                <button class="button is-success" id="new-comment-save" data-id="{{id}}">Save Changes</button>
                <button class="button" id="cancel">Cancel</button>
            </footer>
        </div>
    </div>
</div>

{{!-- edit comment modal --}}
<div class="modal" id="editComment{{id}}" aria-hidden="true">
    <div class="modal-background">
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Editing Comment</p>
                <button class="delete" aria-label="close"></button>
            </header>

            <section class="modal-card-body">
                <textarea class="textarea" id="edited-comment{{id}}">{{comment_body}}</textarea>
            </section>

            <footer class="modal-card-foot">
                <button class="button is-success" id="edit-comment-save" data-id="{{id}}">Save Changes</button>
                <button class="button" id="cancel">Cancel</button>
            </footer>
        </div>
    </div>
</div>

{{!-- delete comment modal --}}
<div class="modal" id="deleteComment{{id}}" aria-hidden="true">
    <div class="modal-background">
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Deleting Comment</p>
                <button class="delete" aria-label="close"></button>
            </header>

            <section class="modal-card-body">
                <p>Are you sure you want to delete this comment?</p>
            </section>

            <footer class="modal-card-foot">
                <button class="button is-danger" id="delete-comment" data-id="{{id}}">Confirm</button>
                <button class="button" id="cancel">Cancel</button>
            </footer>
        </div>
    </div>
</div>

{{!-- script tag to open and close modals --}}
<script>
    const modalTriggers = (document.querySelectorAll('.js-modal-trigger'));
    [...modalTriggers].forEach($trigger => {
        const modal = $trigger.dataset.target;
        const $target = document.getElementById(modal);

        $trigger.addEventListener('click', () => {
            openModal($target);
        });
    });

    const modalClosers = (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, #cancel'))
    [...modalClosers].forEach($close) => {
        const $target = $close.closest('.modal');

        $close.addEventListener('click', () => {
            closeModal($target);
        });
    };
</script>